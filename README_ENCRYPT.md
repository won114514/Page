# 文章加密功能使用说明

本文档介绍了 WON's Blog 中基于 AES 加密的文章内容保护功能的使用方法。

## 功能概述

- 使用 AES-256-CBC 算法对文章内容进行加密保护
- 支持在文章 front-matter 中配置加密选项
- 前端使用 Web Crypto API 进行解密，安全可靠
- 提供密码提示功能，方便用户记忆密码

## 配置方法

在文章的 front-matter 中添加以下字段：

```yaml
title: "机密项目计划"
date: 2026-02-13
encrypt: true
aes_key_hint: "请输入项目代号（6位字母）"
aes_key: "your-secret-key"
```

### 字段说明

- `encrypt`：是否启用文章内容加密（true / false）
- `aes_key_hint`：可选字段，给用户的密码提示（例如："生日后四位"）
- `aes_key`：可选字段，文章的加密密钥（如果未提供，将使用默认密钥）

## 工作原理

1. **构建时**：文章内容在构建过程中使用 AES-256-CBC 算法加密
   - 系统使用文章 front-matter 中定义的 `aes_key` 字段作为加密密钥
   - 如果文章没有定义 `aes_key`，则使用默认密钥
   - 加密后的内容存储在页面中，等待用户解密

2. **前端**：当用户访问加密文章时，系统会提示输入密码
   - 显示解密界面，包含密码输入框和错误提示
   - 如果文章配置了 `aes_key_hint`，会显示相应的密码提示

3. **解密**：用户输入密码后，前端使用 Web Crypto API 进行解密
   - 使用 PBKDF2 从用户输入的密码派生 AES 密钥
   - 使用派生的密钥和存储的 IV 解密文章内容
   - 验证解密是否成功（检查解密后内容的长度）

4. **显示**：解密成功后，显示文章内容
   - 将解密后的 Markdown 转换为 HTML
   - 显示解密后的内容，并添加平滑的进入动画
   - 如果解密失败，显示错误提示信息

## 安全建议

1. **密码强度**：使用强密码，建议包含字母、数字和特殊字符
2. **密码管理**：不要使用简单的密码，避免使用与个人信息相关的密码
3. **备份**：重要文章请做好备份，避免密码丢失导致内容无法恢复
4. **不要泄露**：切勿在 `aes_key_hint` 中泄露真实密码

## 使用示例

### 示例 1：简单加密

```yaml
title: "个人日记"
date: 2026-02-13
encrypt: true
aes_key_hint: "请输入密码"
aes_key: "my-secret-password"
---

# 个人日记

今天是个好日子...
```

### 示例 2：带密码提示

```yaml
title: "项目方案"
date: 2026-02-13
encrypt: true
aes_key_hint: "密码：项目启动日期"
aes_key: "project2026"
excerpt: "这是一个项目方案文档"
---

# 项目方案

## 项目概述

...
```

## 技术实现

- **加密算法**：AES-256-CBC
- **密钥派生**：PBKDF2 从用户输入的口令派生 AES 密钥（100000 次迭代，SHA-256 哈希）
- **前端解密**：使用 Web Crypto API（现代浏览器原生支持）
- **安全性**：加密/解密过程完全在本地完成，避免明文上传到服务器
- **当前实现**：
  - 使用文章 front-matter 中定义的 `aes_key` 字段进行构建时加密
  - 如果文章没有定义 `aes_key`，则使用默认密钥
  - 前端验证密码是否正确，只有输入正确密码才能解密
  - 解密失败时显示错误提示信息
  - 包含基本的 Markdown 解析功能，支持标题、粗体、斜体、列表等格式

## 常见问题

### Q: 忘记密码怎么办？
A: 目前无法恢复忘记密码的加密文章，请妥善保管密码。

### Q: 加密文章的摘要会被加密吗？
A: 不会，文章摘要（excerpt）不会被加密，会正常显示在文章列表中。

### Q: 加密文章支持搜索吗？
A: 目前不支持，加密文章的内容不会被包含在搜索索引中。

### Q: 加密功能会影响网站性能吗？
A: 影响很小，只有在访问加密文章时才会执行解密操作。

## 注意事项

1. 加密功能仅保护文章正文内容，文章标题、日期等元数据不会被加密
2. 建议使用现代浏览器访问加密文章，以获得最佳的解密性能
3. 不要在加密文章中包含敏感信息，加密仅作为一层保护，不是绝对安全的
4. 定期备份您的加密文章和密码

---

**安全提示**：虽然我们使用了安全的加密算法，但任何加密系统都不是绝对安全的。请根据内容的敏感程度选择合适的保护措施。
